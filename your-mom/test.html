<html>
    <head>
        <!-- The core Firebase JS SDK is always required and must be listed first -->
        <script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-app.js"></script>

        <!-- TODO: Add SDKs for Firebase products that you want to use
            https://firebase.google.com/docs/web/setup#available-libraries -->
        <script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-analytics.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-database.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-storage.js"></script>
        <script src="base.js"></script>
    </head>
    <body>
        <img src="" id = "main">
        <p></p>
        <button id = "select">Select File</button>
        <button id = "retrieve">Retrieve Image</button>
        <p></p>
    </body>
    <style>
        #main {
            width: 500;
            height: 500;
        }
    </style>
    <script>
        function getIP(json) {
          //alert("My public IP address is: " + json.ip);
          //console.log(json.ip);
        }
    </script>
        <script src="https://api.ipify.org?format=jsonp&callback=getIP"></script>
        <script type="application/javascript" src="https://api.ipify.org?format=jsonp&callback=getIP"> </script>
    <script>


        const metadata = {
            contentType: "image/png"
        }

        function submitImage() {

        }

        let imgURL = document.getElementById("main");
        document.getElementById("select").onclick = function() {
            let im = document.createElement("input");
            //let reference = storage.ref();
            let s = new Image();
            im.type = "file";
            im.accept = ".png";
            im.click();
            im.onchange = e => {
                files = e.target.files;
                reader = new FileReader();
                reader.onload = function() {
                    document.getElementById("main").src = reader.result;
                    console.log(reader);
                    s.src = reader.result;
                }
                reader.readAsDataURL(files[0]);
            }
            let cFile = prompt("What would you like to save the file as (.png is already assumed)");
            cFile += ".png"
            console.log(cFile);
            let task = storage.child(cFile).put(s, metadata);
            task.on(firebase.storage.TaskEvent.STATE_CHANGED, // or 'state_changed'
                    (snapshot) => {
                        // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded
                        var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        console.log('Upload is ' + progress + '% done');
                        switch (snapshot.state) {
                            case firebase.storage.TaskState.PAUSED: // or 'paused'
                                console.log('Upload is paused');
                                break;
                            case firebase.storage.TaskState.RUNNING: // or 'running'
                                console.log('Upload is running');
                                break;
                        }
                    }
            );
            im.click();
        }

        document.getElementById("retrieve").onclick = function() {
            let fileName = prompt("What is the file name?");
            imgURL.setAttribute("src", "https://storage.googleapis.com/meme-8ecef.appspot.com/" + fileName + ".png");
        }

        /*
        let testIMG = new Image(500, 500);
        testIMG.src = "funny.jpeg";
        */
        
        //let url = rootRef.getDownloadURL();

        //console.log(parse(testIMG.src));
        
        //storage.put(testIMG);
    </script>
</html>